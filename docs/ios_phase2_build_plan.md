# iOS Phase 2 Build Plan for TERASS業動サポートAI

以下は、iOS アプリ版を iPhone 17 Pro でもワンタップで起動・リリースできるようにし、デスクトップ版の機能を維持しつつ、アイコンやアバターの反映と機密情報の安全な管理を実現するためのガイドラインです。初心者にも分かりやすく解説しています。

## アイコンの統一とアバター利用

- `TERASS_icon_all_os.zip` に収録されている最新アイコンとアバターを `terass_ios_app/assets/` 内に配置します。必要であれば unzip コマンドで解凍してください。
- Expo 設定ファイル `app.json` の `icon` プロパティを更新し、解凍した `final_icon.png`（または適切な PNG）を指定します。これによりアプリのアイコンが iOS に反映されます。
- `splash` セクションも更新し、起動画面に同じロゴを利用してください。
- `assets/terass_avatar.png` を新しいアバターに置き換え、チャット画面で女性アバターが表示されるようにします。

## ワンタップ起動・リリースの仕組み

### ワンタップ起動

- iOS アプリはビルド後、ホーム画面に配置されるため、ユーザーはアイコンをタップするだけで起動できます。
- 起動時に必要な API キーやシークレットは環境変数から読み込まれるようにします。コード上にキーを書かないよう注意します。

### ワンタップリリース

- EAS (Expo Application Services) を利用すると、1コマンドで iOS 用の .ipa ファイルを生成できます。以下は秘密情報を安全に注入しながらリリースビルドを実行する例です。

  ```bash
  # <PROJECT_ID> は Bitwarden プロジェクト ID に置き換えてください
  bws run --project-id <PROJECT_ID> -- eas build -p ios --profile production
  ```

- `bws run` コマンドは Secrets Manager に保存しているキーやパスワードを環境変数としてコマンドに注入します【90187748984802†L756-L759】。`--project-id` オプションで特定プロジェクトのシークレットだけを使うことができます【90187748984802†L787-L796】。
- このようにスクリプト化することで、端末上のターミナル操作を最小限に抑え、ワンタップでビルドを実行できるようになります。

## 機能性保持のポイント

- デスクトップ版に実装済みの機能（ローン診断、Picks検索、FAQ拡充など）を iOS 版の React Native アプリに移植します。
  - 例えば、`src/ChatScreen.js` にローン診断ダイアログを追加し、チャット画面に「ローン診断」ボタンを設けます。押すとモーダルウィンドウに入力フォームが表示され、Python で作ったロジックと同等の計算結果を返します。
  - `src/PicksSearchScreen.js`（仮）を作成し、検索条件を入力して Picks API を呼び出す画面を追加します。
  - `src/FAQScreen.js` へ質問項目を追加し、ユーザーが自己解決しやすいよう FAQ を拡充します。

- `src/config.js` の `VECTOR_API_URL` および `KNOWLEDGE_API_URL` を本番用エンドポイントに更新することで、最新の資料検索とベクタ検索に対応します。

## Secrets (APIキー・PW) の自動入力

- アプリでは `.env` ファイルにキーを書かないでください。代わりに Bitwarden Secrets Manager を使い、CLI でシークレットを環境変数として注入します。
- ローカル開発や CI/CD で利用する場合は、先ほど示した `bws run` コマンドを使ってプロセスに秘密情報を渡してください。POSIX に適した環境変数名でない場合は `--uuids-as-keynames` オプションも検討します【90187748984802†L750-L772】。
- Expo/EAS CLI のビルドステップでは、秘密情報を `eas.json` で参照しないようにし、GitHub Secrets などで渡す場合も Bitwarden から取得した値をセットするようにします。

## ワンタップでの操作性を高める提案

- **スクリプト化**：`scripts/build_ios.sh` のようなシェルスクリプトをリポジトリに追加し、`bws run` と `eas build` のコマンドを一括実行するようにします。
- **README 更新**：初心者向けに「アイコンの設定方法」「アバター変更手順」「ビルドスクリプトの使い方」「Bitwarden からシークレットを注入する方法」を具体的に説明する文書を追加します。
- **CI/CD の利用**：GitHub Actions で iOS ビルドを実行し、`secrets` に Bitwarden のアクセス・トークンを設定して `bws run` で注入するフローを構築すると、ワンタップでリリースファイルを生成できます。

以上の内容を実装・反映することで、iOS アプリ版もワンタップ操作に近い形でリリース・起動ができ、デスクトップ版と同等の機能を持つアプリを提供することができます。EOF
